From 2fc463d0efbd044a8232611f0898eeb12b72a970 Mon Sep 17 00:00:00 2001
From: Chris Liddell <chris.liddell@artifex.com>
Date: Fri, 20 Oct 2017 14:16:44 +0100
Subject: [PATCH] Bug 698676: have filenameforall permission check use
 "reduced" path

Prevents working around SAFER file access permissions.

CVE-2017-15652
---
 psi/zfile.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/psi/zfile.c b/psi/zfile.c
index 458339d..00da24c 100644
--- a/psi/zfile.c
+++ b/psi/zfile.c
@@ -410,7 +410,7 @@ file_continue(i_ctx_t *i_ctx_p)
         } else if (code > len)      /* overran string */
             return_error(gs_error_rangecheck);
         else if (iodev != iodev_default(imemory)
-              || (check_file_permissions_reduced(i_ctx_p, (char *)pscratch->value.bytes, code + devlen, iodev, "PermitFileReading")) == 0) {
+              || (check_file_permissions(i_ctx_p, (char *)pscratch->value.bytes, code + devlen, iodev, "PermitFileReading")) == 0) {
             push(1);
             ref_assign(op, pscratch);
             r_set_size(op, code + devlen);
-- 
2.9.1
